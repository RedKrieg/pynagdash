{% extends "base.html" %}
{% block title %}Filter List{% endblock %}
{% block head %}
{{ super() }}
<script type="text/javascript" src="{{ url_for('static', filename='jquery-1.9.1.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='jquery-ui-1.8.17.custom.min.js') }}"></script>
<script type="text/javascript" id="js">
$(document).ready(function() {
    $(function() {
        $("#availableviews, #myviews").sortable({
            connectWith: ".connectedSortable"
        }).disableSelection();
    });

    $("#saveviews").click(function() {
        var filterNames = [];
        $("#myviews li").each(function(i) {
            filterNames.push(
                $(this).find('a').text()
            );
        });
        //logging to debug this function's "order" issue.
        console.log(filterNames);
        $.post('{{ url_for('list_filters') }}', { 'views': filterNames }, function(data) {
            if ( data.indexOf("success") == -1 ) {
                $('#msgBox div').text("Couldn't update filters!  Check login and the backend!")
                    .slideDown('medium')
                    .delay(3000)
                    .slideUp('medium');
            } else {
                $('#msgBox div').addClass("success")
                    .text("Saved your filters!")
                    .slideDown('medium')
                    .delay(3000)
                    .slideUp('medium')
                    .removeClass("success");
            }
        }).error(function() {

            $('#msgBox div').text("Couldn't update filters!  Check login and the backend!")
                .slideDown('medium')
                .delay(3000)
                .slideUp('medium');
        });;
    });
});
</script>
{% endblock %}
{% block content %}
<div id="msgBox"><div></div></div>
<form id = 'filterlist' action = "{{ url_for('list_filters') }}" method='post'>
    <fieldset>
        <legend>Filters</legend>
        {% for filter in filter_list %}
        <div class="filter">
            <div class="filtername">
                <input type="checkbox" {% if filter['NAME'] in session['views'] %}checked = "checked" {% endif %}name="{{ filter['NAME'] }}" value="{{ filter['NAME'] }}" /><a href="{{ url_for('edit_filter', filtername = filter['NAME']) }}">{{ filter['NAME'] }}</a>:
            </div>
            <div class="filterdesc">
                {{- filter['DESCRIPTION'] -}}
            </div>
        </div><br />
        {% endfor %}
        <input type='submit' name='submit' value='Submit' /><a href="{{ url_for('edit_filter') }}">Create a new filter</a>
        {% if error is not none %}<br /><div class='error'>{{ error }}</div>{% endif %}
    </fieldset>
</form>
Incomplete, do not use:
<div class="viewselect">
    Available views:<br />
    <ul id="availableviews" class="connectedSortable">
        {% for filter in filter_list %}
        {% if filter['NAME'] not in session['views'] %}
        <li class="filter">
            <div class="filtername">
                <a href="{{ url_for('edit_filter', filtername = filter['NAME']) }}">{{ filter['NAME'] }}</a>
            </div>
            <div class="filterdesc">
                {{- filter['DESCRIPTION'] -}}
            </div>
        </li>
        {% endif %}
        {% endfor %}
    </ul>
</div>
<div class="viewselect">
    Your views:<br />
    <ul id="myviews" class="connectedSortable">
        {% for filter in filter_list %}
        {% if filter['NAME'] in session['views'] %}
        <li class="filter">
            <div class="filtername">
                <a href="{{ url_for('edit_filter', filtername = filter['NAME']) }}">{{ filter['NAME'] }}</a>
            </div>
            <div class="filterdesc">
                {{- filter['DESCRIPTION'] -}}
            </div>
        </li>
        {% endif %}
        {% endfor %}
    </ul>
</div>
<a href="#" id="saveviews">Save views</a>
{% endblock %}
