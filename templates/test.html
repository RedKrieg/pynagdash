{% extends "base.html" %}
{% block head %}
{{ super() }}
<script type="text/javascript" src="{{ url_for('static', filename='jquery-1.7.1.min.js') }}"></script>
<script type="text/javascript" id="js">
$(document).ready(function() {
    $(".operator").change(function() {
        var newval = $(this).val();
        var myChild = $(this).parent().children('.childfieldset');
        console.debug( 'hello' /* or message */ )
        if (newval.indexOf("child") != -1) {
            $.get('{{ url_for('get_filter_row') }}', function(data) {
                myChild.html(data);
                myChild.slideDown('medium');
                myChild.find(".operator").change(arguments.callee);
            });
        } else {
            myChild.slideUp('medium');
            myChild.html('');
        }
    });
    $(".chain").change(function() {
        var newval = $(this).val();
        var myParentDiv = $(this).parent();
        if (newval.indexOf("null") == -1) {
            $.get('{{ url_for('get_filter_row') }}', function(data) {
                myParentDiv.parent().append(data);
                myParentDiv.parent().find(".chain").change(arguments.callee);
            });
        } else {
            var nextDiv = myParentDiv.next();
            if (nextDiv.length != 0) {
                nextDiv.remove();
            }
        }
    });
});
</script>
{% endblock %}
{% block title %}Test for filter creation{% endblock %}
{% block content %}
<form id='filter' action = "{{ url_for('save_ruleset') }}" method='post'>
    <fieldset>
        <legend>Filter</legend>
        <label for='title'>Title:</label><input type="text" maxlength="50" name="title" id="title" /><br />
        <div id="filterlist">
        {% include "filter_element.html" %}<br />
        </div>
        {% if error is not none %}<br /><div class='error'>{{ error }}</div>{% endif %}
        <input type='submit' name='submit' value='Submit' />
    </fieldset>
</form>
{% endblock %}
